mailster=function(e,a,t,i){"use strict";var s=a(i.body).hasClass("mobile"),n=a(i.body).hasClass("index-php"),r=a(".mailster-mb-subscribers"),l=a("#mailster-subscriber-range"),o=a("#subscriber-chart-wrap"),d=a("#subscriber-chart"),c,u,f={responsive:false,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(a,t){return e.util.sprintf(e.l10n.dashboard.subscribers,C(a.yLabel))}}},scales:{xAxes:[{ticks:{maxTicksLimit:20},_type:"time",_time:{format:"MM/DD/YYYY HH:mm",round:"day",tooltipFormat:"ll HH:mm"}}],yAxes:[{ticks:{callback:function(e){return v(e,true)}}}]}};if(d.length){u=d[0].getContext("2d")}l.on("change",function(){b()}).trigger("change");!n&&t.postboxes.add_postbox_toggles("newsletter_page_mailster_dashboard");a(i).on("verified.mailster",function(e,t,i,s){a(".mailster-purchasecode").html(t);a(".mailster-username").html(i);a(".mailster-email").html(s);a("#mailster-mb-mailster").addClass("verified");a("#mailster-register-panel").delay(2500).fadeTo(400,0,function(){a("#mailster-register-panel").slideUp(400)})}).on("click",".locked",function(){a(".purchasecode").focus().select()}).on("click",".check-for-update",function(){var t=a(this);t.html(e.l10n.dashboard.checking);e.util.ajax("check_for_update",function(i){t.html(e.l10n.dashboard.check_again);if(i.success){t.closest(".postbox")[i.update?"addClass":"removeClass"]("has-update");a(".update-version").html(i.version);a(".update-last-check").html(i.last_update)}});return false}).one("click",".load-language",function(){var t=a(this);t.html(e.l10n.dashboard.downloading);e.util.ajax("load_language",function(a){if(a.success){t.html(e.l10n.dashboard.reload_page)}});return false}).on("click",".reset-license",function(){if(!confirm(e.l10n.dashboard.reset_license)){return false}});var h=function(t){if(!t){return}var s,n=a(".mailster-mb-"+t),r=n.find(".mailster-mb-select"),l=n.find(".mailster-mb-label"),o=n.find(".mailster-mb-link"),d=o.attr("href");if(!r.length){return}r.on("change",function(){c(a(this).val())}).trigger("change");a(i).on("heartbeat-tick",function(e,a){if(s){c(s,true)}});n.find(".piechart").easyPieChart({animate:1e3,rotate:180,barColor:e.colors.main,trackColor:e.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}});function c(a,i){if(!i){n.addClass("mailster-loading")}e.util.ajax("get_dashboard_data",{type:t,id:a},function(e){var a=e.data;o.html(a.name).removeAttr("class").addClass("mailster-mb-link").attr("href",d.replace("%d",a.ID));if(a.status){o.addClass("status-"+a.status)}n.find(".stats-total").html(a.sent_formatted);n.find(".stats-open").data("easyPieChart").update(a.openrate*100);n.find(".stats-clicks").data("easyPieChart").update(a.clickrate*100);n.find(".stats-unsubscribes").data("easyPieChart").update(a.unsubscriberate*100);n.find(".stats-bounces").data("easyPieChart").update(a.bouncerate*100);s=a.ID;n.removeClass("mailster-loading")})}};var m=new h("campaigns");var p=new h("lists");function b(a,t,i,s){r.addClass("mailster-loading");e.util.ajax("get_dashboard_chart",{range:l.val()},function(e){g();r.removeClass("mailster-loading");if(!c){c=new Chart(u,{type:"line",data:e.chart,options:f})}})}function g(){c=null;if(d){d.remove()}d=a("<canvas>").prependTo(o);u=d[0].getContext("2d");d.attr({width:o.width(),height:o.height()})}function v(e,a){if(e>=1e6){return(e/1e3).toFixed(1)+"M"}else if(e>=1e3&&!a){return(e/1e3).toFixed(1)+"K"}return!(e%1)?C(e):""}function C(e,a,t,i){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var s=!isFinite(+e)?0:+e;var n=!isFinite(+a)?0:Math.abs(a);var r=typeof i==="undefined"?",":i;var l=typeof t==="undefined"?".":t;var o="";var d=function(e,a){var t=Math.pow(10,a);return""+(Math.round(e*t)/t).toFixed(a)};o=(n?d(s,n):""+Math.round(s)).split(".");if(o[0].length>3){o[0]=o[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)}if((o[1]||"").length<n){o[1]=o[1]||"";o[1]+=new Array(n-o[1].length+1).join("0")}return o.join(l)}return e}(mailster||{},jQuery,window,document);