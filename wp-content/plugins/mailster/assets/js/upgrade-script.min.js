mailster=function(e,t,n,i){"use strict";if(typeof mailster_updates=="undefined"){return}var u=t("#output"),o=t("#error-list"),r=[],s,a,p=t('<span>&nbsp;</span><a class="skipbutton button button-small" href title="skip this step">skip</a>'),l=false,f=mailster_updates_performance[0]||1,d=t.map(mailster_updates,function(e,t){return t});u.on("click",".skipbutton",function(){l=true;return false});e.$.document.ajaxError(function(){o.append("script paused...continues in 5 seconds<br>");setTimeout(function(){o.empty();c(a,true)},5e3)});if(mailster_updates_options.autostart){t("#mailster-update-process").show();c(0)}else{t("#mailster-update-info").show();t("#mailster-start-upgrade").on("click",function(){t("#mailster-update-process").slideDown(200);t("#mailster-update-info").slideUp(200);c(0)})}function c(e,t){if(!e){n.onbeforeunload=function(){return"You have to finish the update before you can use Mailster!"}}var i=d[e];a=e;if(!(s=mailster_updates[i])){b();return}if(!t)w(i,"<strong>"+s+"</strong> ...",true);m(i,function(){setTimeout(function(){c(++e)},1e3)},function(){h()},1)}function m(t,n,i,u){e.util.ajax("batch_update",{id:t,performance:f},function(e){if(e&&e.success){if(e.output)_(e.output);if(l){w(t," &otimes;",false);l=false;n&&n()}else if(e[t]){w(t," &#10004;",false);n&&n()}else{w(t,".",false,u);setTimeout(function(){m(t,n,i,++u)},5)}}else{i&&i()}},function(e,t,n){_(e.responseText);alert("There was an error while doing the update! Please check the textarea on the right for more info!");h()})}function h(){n.onbeforeunload=null;w("error","error",true)}function b(){n.onbeforeunload=null;w("finished","<strong>Alright, all updates have been finished!</strong>",true,0,true);w("finished_button",'<a href="admin.php?page=mailster_welcome" class="button button-primary">Ok, fine!</a>',true,0,true);t("#mailster-post-upgrade").show()}function w(e,n,i,o,r){var s=t("#output_"+e).length?t("#output_"+e):t('<div id="output_'+e+'" class="'+(r?"":"updated inline")+'" style="padding: 0.5em 6px;word-wrap: break-word;"></div>').appendTo(u);s.append(n);o>20?s.append(p.show()):p.hide()}function _(n){var i=t("#textoutput").val();n=n+"\n\n"+i;t("#textoutput").val(e.util.trim(n))}return e}(mailster||{},jQuery,window,document);