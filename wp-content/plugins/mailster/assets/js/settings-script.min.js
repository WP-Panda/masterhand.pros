mailster=function(e,t,i,s){"use strict";var n=t(".mainnav"),a=t("#deliverynav"),l=t(".tab"),o=t("#tab-delivery").find(".subtab"),c=t("#mailster_nonce").val(),r=t("#reserved-tags").data("tags");t("form#mailster-settings-form").on("submit.lock",function(){return false});if(t("#settingsloaded").length){t(".submit-form").prop("disabled",false);t("form#mailster-settings-form").off("submit.lock")}else{e.log("error loading settings page")}a.on("click","a.nav-tab",function(){a.find("a").removeClass("nav-tab-active");o.hide();var i=t(this).addClass("nav-tab-active").attr("href");t("#deliverymethod").val(i.substr(1));t("#subtab-"+i.substr(1)).show();t("input.mailster_sendtest").val(e.l10n.settings.save_to_test).prop("disabled",true);return false});n.on("click","a",function(){n.find("li").removeClass("active");l.hide();var e=t(this).parent().addClass("active").find("a").attr("href");t("#tab-"+e.substr(1)).show();location.hash=e;t("form#mailster-settings-form").attr("action","options.php"+e);if("#authentication"==e){f();u()}return false});t(".click-to-select").on("click",function(e){if(s.selection){var t=s.body.createTextRange();t.moveToElementText(this);t.select()}else if(i.getSelection){var t=s.createRange();t.selectNode(this);i.getSelection().addRange(t)}});t("#mailster-settings-form").on("click",'a[href^="#"]',function(){n.find('a[href="'+t(this).attr("href")+'"]').trigger("click")});location.hash&&n.find('a[href="'+location.hash+'"]').length?n.find('a[href="'+location.hash+'"]').trigger("click"):n.find("a").eq(0).trigger("click");t(".system_mail").on("change",function(){t('[name="mailster_options[system_mail_template]"]').prop("disabled",t(this).val()==0);t('[name="mailster_options[respect_content_type]"]').prop("disabled",t(this).val()==0)});t("#load_location_db").on("click",function(){var i=t(this),s=t(".geo-ajax-loading").css({visibility:"visible"});t("button").prop("disabled",true);e.util.ajax("load_geo_data",function(e){t("button").prop("disabled",false);s.css({visibility:"hidden"});i.prop("disabled",false).html(e.buttontext);if(e.update)t("#location_last_update").html(e.update);var n=t('<div class="'+(!e.success?"error":"updated")+'"><p>'+e.msg+"</p></div>").hide().prependTo(i.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){n.remove()})},function(e,n,a){t("button").prop("disabled",false);s.css({visibility:"hidden"});i.prop("disabled",false);var l=t('<div class="error"><p>'+n+" "+e.status+": "+a+"</p></div>").hide().prependTo(i.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){l.remove()})});return false});t(".webversion-bar-checkbox").on("change",function(){t(this).is(":checked")?t("#webversion-bar-options").slideDown(200):t("#webversion-bar-options").slideUp(200)});t("#social-services").on("change",".social-service-dropdown",function(){var e=t(this),i=e.find(":selected"),s=i.data("url");e.next(".social-service-url-field").html('<label><span class="description">'+s.replace("%s",'<input type="text" name="mailster_options[services]['+e.val()+']" value="" class="regular-text">')+"</span></label>").find("input").focus()}).on("click",".social-service-remove",function(){t(this).parent().remove();return false});t(".social-service-add").on("click",function(){t("#social-services").find("li").eq(0).clone().appendTo("#social-services").find("select").val(0).parent().find(".social-service-url-field").empty()});t(".has-archive-check").on("change",function(){t(this).is(":checked")?t(".archive-slug").slideDown(200):t(".archive-slug").slideUp(200)});t(".edit-slug").on("click",function(){t(this).parent().parent().find("span").hide().filter(".edit-slug-area").show().find("input").focus().select()});t(".users-register").on("change",function(){t(this).is(":checked")?t("#"+t(this).data("section")).slideDown(200):t("#"+t(this).data("section")).slideUp(200)});t("#mailster_spf").on("change",function(){t(this).is(":checked")?t(".spf-info").slideDown(200):t(".spf-info").slideUp(200)});t("#mailster_dkim").on("change",function(){t(this).is(":checked")?t(".dkim-info").slideDown(200):t(".dkim-info").slideUp(200)});t(".dkim-enter-keys").on("click",function(){t(".dkim-keys").slideDown();return false});t("#bounce_active").on("change",function(){t(this).is(":checked")?t("#bounce-options").slideDown(200):t("#bounce-options").slideUp(200)});t("#mailster_generate_dkim_keys").on("click",function(){return t("#dkim_keys_active").length&&confirm(e.l10n.settings.create_new_keys);return false});t("input.smtp.secure").on("change",function(){t("#mailster_smtp_port").val(t(this).data("port"))});t("#capabilities-table").on("mouseenter","label",function(){t("#current-cap").stop().html(t(this).attr("title")).css("opacity",1).show()}).on("mouseleave","tbody",function(){t("#current-cap").fadeOut()}).on("change","input.selectall",function(){var e=t(this);t("input.cap-check-"+e.val()).prop("checked",e.prop("checked"))});t(".mailster_sendtest").on("click",function(){var i=t(this),s=i.closest(".mailster-testmail"),n=s.find(".test-ajax-loading").css({visibility:"visible"}),a=s.find("input.mailster-testmail-email").val(),l=t("form#mailster-settings-form").serialize();i.prop("disabled",true);e.util.ajax("send_test",{test:true,formdata:l,basic:true,to:a},function(s){if(s.log)s.success?e.log(s.log):e.log(s.log,"error");n.css({visibility:"hidden"});i.prop("disabled",false);var a=t('<div class="'+(!s.success?"error":"updated")+'"><p>'+s.msg+"</p></div>").hide().prependTo(i.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){a.remove()})},function(e,s,a){n.css({visibility:"hidden"});i.prop("disabled",false);var l=t('<div class="error"><p>'+s+" "+e.status+": "+a+"</p></div>").hide().prependTo(i.parent()).slideDown(200).delay(200).fadeIn().delay(4e3).fadeTo(200,0).delay(200).slideUp(200,function(){l.remove()})})});t(".mailster_bouncetest").on("click",function(){var i=t(this),s=t(".bounce-ajax-loading").css({visibility:"visible"}),n=t(".bouncetest_status").empty().show(),a=t("form#mailster-settings-form").serialize();i.prop("disabled",true);e.util.ajax("bounce_test",{formdata:a},function(e){d(e.identifier,1,a,function(){i.prop("disabled",false)})},function(e,t,a){s.css({visibility:"hidden"});i.prop("disabled",false);n.html(t+" "+e.status+": "+a)})});t("input.cron_radio").on("change",function(){t(".cron_opts").hide();t("."+t(this).val()).show()});t(".switch-cron-url").on("click",function(){t(".cron_opts").toggleClass("alternative-cron");return false});t("#mailster_add_tag").on("click",function(){var e=t('<div class="tag"><code>{<input type="text" class="tag-key">}</code> &#10152; <input type="text" class="regular-text tag-value"> <a class="tag-remove">&#10005;</a></div>').insertBefore(t(this));e.find(".tag-key").focus()});t(".tags").on("change",".tag-key",function(){var e=t(this),i=e.parent().parent(),s=p(e.val());if(!s)e.parent().parent().remove();e.val(s);i.find(".tag-value").attr("name","mailster_options[custom_tags]["+s+"]")}).on("click",".tag-remove",function(){t(this).parent().remove();return false});t("#mailster_add_field").on("click",function(){var i=t('<div class="customfield"><a class="customfield-move-up" title="'+e.l10n.settings.move_up+'">&#9650;</a><a class="customfield-move-down" title="'+e.l10n.settings.move_down+'">&#9660;</a><div><span class="label">'+e.l10n.settings.fieldname+':</span><label><input type="text" class="regular-text customfield-name"></label></div><div><span class="label">'+e.l10n.settings.tag+':</span><span><code>{</code><input type="text" class="customfield-key code"><code>}</code></span></div><div><span class="label">'+e.l10n.settings.type+':</span><select class="customfield-type"><option value="textfield">'+e.l10n.settings.textfield+'</option><option value="textarea">'+e.l10n.settings.textarea+'</option><option value="dropdown">'+e.l10n.settings.dropdown+'</option><option value="radio">'+e.l10n.settings.radio+'</option><option value="checkbox">'+e.l10n.settings.checkbox+'</option><option value="date">'+e.l10n.settings.datefield+'</option></select></div><ul class="customfield-additional customfield-dropdown customfield-radio"><li><ul class="customfield-values"><li><span>&nbsp;</span> <span class="customfield-value-box"><input type="text" class="regular-text customfield-value" value=""> <label><input type="radio" value="" title="'+e.l10n.settings.default_selected+'" class="customfield-default" disabled> '+e.l10n.settings.default_field+'</label></span></li></ul><span>&nbsp;</span> <a class="customfield-value-add">'+e.l10n.settings.add_field+'</a></li></ul><div class="customfield-additional customfield-checkbox"><span>&nbsp;</span><label><input type="checkbox" value="1" title="'+e.l10n.settings.default_field+'" class="customfield-default" disabled> '+e.l10n.settings.default_checked+'</label></div><a class="customfield-remove">remove field</a><br></div>').appendTo(t(".customfields").eq(0));i.find(".customfield-name").focus()});t("#sync_list_check").on("change",function(){t("#sync_list").slideToggle(200);t(".sync-button").prop("disabled",true)});t("#sync_list").on("click","#add_sync_item",function(){var e=t(".mailster_syncitem");e.eq(0).clone().insertAfter(e.last()).removeAttr("title").find("select").each(function(){t(this).attr("name",t(this).attr("name").replace("[synclist][0]","[synclist]["+e.length+"]"))});t(".sync-button").prop("disabled",true)}).on("click",".remove-sync-item",function(){t(this).parent().remove();t(".sync-button").prop("disabled",true)}).on("change","select",function(){t(".sync-button").prop("disabled",true)}).on("click","#sync_subscribers_wp",function(i){if(i&&i.originalEvent&&!confirm(e.l10n.settings.sync_subscriber))return false;var s=t(this),n=t(".sync-ajax-loading").css({visibility:"visible"});t(".sync-button").prop("disabled",true);e.util.ajax("sync_all_subscriber",{offset:s.data("offset")},function(e){t(".sync-button").prop("disabled",false);if(e.success&&e.count){s.data("offset",e.offset).trigger("click")}else{n.css({visibility:"hidden"});s.data("offset",0)}},function(e,i,s){n.css({visibility:"hidden"});t(".sync-button").prop("disabled",false)});return false}).on("click","#sync_wp_subscribers",function(i){if(i&&i.originalEvent&&!confirm(e.l10n.settings.sync_wp_user))return false;var s=t(this),n=t(".sync-ajax-loading").css({visibility:"visible"});t(".sync-button").prop("disabled",true);e.util.ajax("sync_all_wp_user",{offset:s.data("offset")},function(e){t(".sync-button").prop("disabled",false);if(e.success&&e.count){s.data("offset",e.offset).trigger("click")}else{n.css({visibility:"hidden"});s.data("offset",0)}},function(e,i,s){n.css({visibility:"hidden"});t(".sync-button").prop("disabled",false)});return false});t(".customfields").on("change",".customfield-name",function(){var e=t(this),i=e.parent().parent().parent().find(".customfield-key");if(!i.val())i.val(e.val()).trigger("change")}).on("change",".customfield-key",function(){var e=t(this),i=e.parent().parent().parent(),s=p(e.val());if(!s)i.remove();e.val(s);i.find(".customfield-name").attr("name","mailster_options[custom_field]["+s+"][name]");i.find(".customfield-type").attr("name","mailster_options[custom_field]["+s+"][type]");i.find(".customfield-value").attr("name","mailster_options[custom_field]["+s+"][values][]");i.find(".customfield-default").attr("name","mailster_options[custom_field]["+s+"][default]")}).on("click",".customfield-remove",function(){t(this).parent().remove()}).on("click",".customfield-move-up",function(){var e=t(this).parent();e.insertBefore(e.prev())}).on("click",".customfield-move-down",function(){var e=t(this).parent();e.insertAfter(e.next())}).on("change",".customfield-type",function(){var e=t(this).val();t(this).parent().parent().find(".customfield-additional").slideUp(200).find("input").prop("disabled",true);if(e!="textfield"){t(this).parent().parent().find(".customfield-"+e).stop().slideDown(200).find("input").prop("disabled",false)}}).on("change",".customfield-value",function(){t(this).next().find("input").val(t(this).val())}).on("click","a.customfield-value-remove",function(){t(this).parent().parent().remove()}).on("click","a.customfield-value-add",function(){var e=t(this).parent().find("li").eq(0).clone();e.appendTo(t(this).parent().find("ul")).find("input").val("").focus().select()});t("#mailster_import_data").on("click",function(){if(!confirm(e.l10n.settings.import_data))return false});t("#mailster_reset_data").on("click",function(){if(!confirm(e.l10n.settings.reset_data))return false});function d(i,s,n,a){var l=t(this),o=t(".bounce-ajax-loading").css({visibility:"visible"}),c=t(".bouncetest_status");e.util.ajax("bounce_test_check",{identifier:i,passes:s,formdata:n},function(e){c.html(e.msg);if(e.complete){o.css({visibility:"hidden"});a&&a()}else{setTimeout(function(){d(i,++s,n,a)},1e3)}},function(e,t,i){o.css({visibility:"hidden"});l.prop("disabled",false);c.html(t+" "+e.status+": "+i)})}function f(){var i=t(".spf-result").css({visibility:"visible"});e.util.ajax("spf_check",function(e){if(e.success){i.html(e.message).addClass(e.found?"verified":"not-verified").removeClass("spinner")}else{}},function(e,t,s){i.html("error")})}function u(){var i=t(".dkim-result").css({visibility:"visible"});e.util.ajax("dkim_check",function(e){if(e.success){i.html(e.message).addClass(e.found?"verified":"not-verified").removeClass("spinner")}else{}},function(e,t,s){i.html("error")})}function p(i){var s=e.util.trim(i).toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9_-]*/g,"").replace(/^[_]*/,"").replace(/[_]*$/,"");if(t.inArray(s,r)!=-1){alert(e.util.sprintf(e.l10n.settings.reserved_tag,'"'+s+'"'));s+="-a"}return s}return e}(mailster||{},jQuery,window,document);