mailster=function(e,t,n,i){"use strict";e.events.push("documentReady",function(){var i=false,o=t(".useit-nav"),a=t(".useit-tab"),r=t("#ID").val(),c=t("#form_form"),s=t("#form-builder"),l=t("#form-structure"),u=t("#form-fields");c.on("submit",function(){n.onbeforeunload=null});t("#use-it").on("click",function(){tb_show(e.l10n.form.useit,"#TB_inline?&width="+Math.min(1200,e.$.window.width()-50)+"&height="+(e.$.window.height()-100)+"&inlineId=useitbox",null);if(i)alert(e.l10n.form.not_saved);return false});o.on("click","a",function(){o.find("li").removeClass("active");a.hide();var e=t(this).parent().addClass("active").find("a").attr("href");t("#tab-"+e.substr(1)).show();return false});a.hide().eq(0).show();s.find(".sortable").sortable({containment:t("#form_form"),connectWith:".sortable",placeholder:"ui-state-highlight",start:function(e,t){s.addClass("dragging")},stop:function(e,t){s.removeClass("dragging")},receive:function(e,n){l.find("input").each(function(){t(this).attr("name",t(this).data("name"))});u.find("input").each(function(){t(this).removeAttr("name")})},update:function(e,t){d()},remove:function(e,t){}});u.on("click",".form-field",function(){t(this).appendTo("#form-structure .form-order");l.find("input").each(function(){t(this).attr("name",t(this).data("name"))});u.find("input").each(function(){t(this).removeAttr("name")})});l.on("click",".submitbutton input",function(e){e.preventDefault();t(this).focus().select()}).on("click",".field-remove",function(e){e.preventDefault();var n=t(this).parent().parent().parent();n.appendTo(u.find("ul"));n.find("input").removeAttr("name")});function d(){i=true;n.onbeforeunload=function(){return e.l10n.form.require_save}}var f="",h,p=t("input#style"),m=t(".add-custom-style"),v=t("#custom-style"),b=t("#custom-style-prefix"),g=t("#custom-style-samples"),w=t("#form-design-iframe"),k,y=t(".designnav"),_=t(".designtab"),D=t(".color-field"),T=t("[data-selector]");w.on("load",function(){h=t('<style id="mailster_form_preview_css"></style>').appendTo(w.contents().find("head"));q();w.contents().find("style.mailster-custom-form-css").remove()});m.on("click",function(){var e=t(this).parent().find(".color-field"),n=".mailster-form-"+r+" "+e.data("selector")+"{\n    \n}\n";v.val(v.val()+b.val()+n)});y.on("click","a.nav",function(){y.find("a").removeClass("nav-tab-active");_.hide();var e=t(this).addClass("nav-tab-active").attr("href");t("#"+e.substr(1)).show();return false}).find("a.nav").eq(0).trigger("click");D.wpColorPicker({clear:function(e,t){q()},change:function(e,t){clearTimeout(k);k=setTimeout(function(){q();d()},20)}});t("#themestyle").on("change",function(){w.attr("src",w.attr("src").replace(/&s=(1|0)/,"&s="+(t(this).prop("checked")?1:0)))});v.on("change",function(){q();d()});g.find("option").on("click",function(){v.val(v.val()+b.val()+".mailster-form-"+r+t(this).val()+"{\n    \n}\n");v[0].scrollTop=v[0].scrollHeight});t("#title").on("change",d);t("#form-builder").on("change","input",d);t("#form-options").on("change","input",d).on("change",".mailster_userschoice",function(){var e=t(this).is(":checked");t(this).parent().parent().parent().parent().find("legend.mailster_userschoice_td").hide().eq(e?1:0).show();t(this).parent().parent().find(".mailster_dropdown").prop("disabled",!e);t(this).parent().parent().parent().parent().find(".mailster_precheck").prop("disabled",e?0:1)}).on("change","#redirect-cb",function(){t("#redirect-tf").prop("disabled",!t(this).is(":checked"))}).on("change",".double-opt-in",function(){!parseInt(t(this).val(),10)?t("#double-opt-in-field").slideUp(200):t("#double-opt-in-field").slideDown(200)}).on("change",".vcard",function(){t(this).is(":checked")?t("#vcard-field").slideDown(200):t("#vcard-field").slideUp(200)});function q(){f="";var e={};t.each(T,function(){var n=t(this),i=n.data("selector"),o=n.data("property"),a=n.data("postfix")||"",r=n.val();if(!r)return;e[i]=e[i]||{};e[i][o]=r+a});t.each(e,function(e,n){f+="form.mailster-form.mailster-form-"+r+" "+e+"{\n";t.each(n,function(e,t){f+="\t"+e+": "+t+";\n"});f+="}\n"});f+=v.val().replace(/(<([^>]+)>)/gi,"");h.html(f);p.val(escape(JSON.stringify(e)));w[0].height=w[0].contentWindow.document.body.scrollHeight+"px"}var C=t(".button-options-wrap").find("input"),I=t(".button-preview"),S=t(".code-preview").find("textarea"),x=t(".shortcode-preview").find("input");C.on("change",A);t(".subscriber-button-style").on("change","input",A);S.on("click",function(){t(this).select()});x.on("click",function(){t(this).select()});t(".embed-form-input").on("change",function(){var n=t(this).parent().parent().parent(),i=n.find(".embed-form-input"),o=n.find(".embed-form-output");o.val(e.util.sprintf(o.data("embedcode"),i.eq(0).val(),i.eq(1).val(),i.eq(2).is(":checked")?"&style=1":""))}).eq(0).trigger("change");t(".embed-form-output").on("focus",function(){t(this).select()});t(".form-output").on("focus",function(){t(this).select()});t(".nav-subscriber-button").on("click",function(){A()});function A(){var e=n.mailsterdata.embedcode,i=t("#ID").val(),o=t("#buttonwidth").val()||480,a="[newsletter_button id="+i,r=t("#showcount").prop("checked"),c=t("input[name=subscriber-button-style]:checked").val(),s=t("#ontop").prop("checked"),l=t("input[name=buttonlabel]:checked").val()=="custom",u=l?t("#buttonlabel").val():t("#buttonlabel").attr("placeholder");u=u?u.replace(/(<([^>]+)>)/gi,""):"";c=c+(s?" ontop":"");if(n.MailsterSubscribe&&n.MailsterSubscribe.loaded)n.MailsterSubscribe.destroy();I.html("");e=e.replace("%ID%",i).replace("%SHOWCOUNT%",r?' data-showcount="1"':"").replace("%WIDTH%",o!=480?' data-width="'+o+'"':"").replace("%DESIGN%",c!="default"?' data-design="'+c+'"':"").replace("%LABEL%",u);I.html(e);S.val(e);if(c&&c!="default")a+=' design="'+c+'"';if(l)a+=' label="'+u+'"';if(r)a+=' showcount="'+r+'"';if(o!=480)a+=' width="'+o+'"';a+="]";x.val(a)}});return e}(mailster||{},jQuery,window,document);