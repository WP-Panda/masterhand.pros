mailster=function(e,t,i,a){"use strict";e.$=e.$||{};e.$.body=t("body");e.$.wpbody=t("#wpbody");e.$.form=t("#post");e.$.title=t("#title");e.$.iframe=t("#mailster_iframe");e.$.templateWrap=t("#template-wrap");e.$.template=t("#mailster_template");e.$.datafields=t('[name^="mailster_data"]');e.$.content=t("#content");e.$.excerpt=t("#excerpt");e.$.plaintext=t("#plain-text-wrap");e.$.html=t("#html-wrap");e.$.head=t("#head");e.$.optionbar=t("#optionbar");e.$.editbar=t("#editbar");e.campaign_id=parseInt(t("#post_ID").val(),10);e.user_id=parseInt(t("#user-id").val(),10);e.enabled=false;e.editable=!t("#mailster_disabled").val();return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.events.push("documentReady",function(){if(!e.editable){e.$.iframe.on("load",function(){e.trigger("iframeLoaded")})}e.$.iframe.attr("src",e.$.iframe.data("src"))});e.events.push("editorLoaded",function(){e.$.iframe.removeClass("loading")});e.events.push("iframeLoaded",function(){e.$.iframe.removeClass("loading");e.$.iframecontents=e.$.iframe.contents()});e.events.push("disable",function(){e.enabled=false});e.events.push("enable",function(){e.enabled=true});e.events.push("redraw",function(){e.trigger("refresh")});e.events.push("resize",function(){t("#editor-height").val(e.editor.getHeight())});e.events.push("save",function(){if(!e.editor||!e.editor.loaded)return;var t=e.editor.getFrameContent(),i=e.optionbar.undos.length,a=e.optionbar.undos[i-1];if(a!=t){e.$.content.val(t);e.details.$.preheader.prop("readonly",!t.match("{preheader}"));e.optionbar.undos=e.optionbar.undos.splice(0,e.optionbar.currentUndo+1);e.optionbar.undos.push(t);if(i>=e.l10n.campaigns.undosteps)e.optionbar.undos.shift();e.optionbar.currentUndo=e.optionbar.undos.length-1;if(e.optionbar.currentUndo)e.$.optionbar.find("a.undo").removeClass("disabled");e.$.optionbar.find("a.redo").addClass("disabled");if(wp&&wp.autosave)wp.autosave.local.save()}});return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";var n;if(e.util.isMSIE)e.$.body.addClass("ie");if(e.util.isTouchDevice)e.$.body.addClass("touch");e.$.window.on("resize.mailster",s);e.$.document.on("change","input[name=screen_columns]",function(){e.$.window.trigger("resize")}).on("click",".restore-backup",function(t,i){var i=wp.autosave.local.getSavedPostData();e.editor.setContent(i.content);e.$.title.val(i.post_title);return false}).on("submit","form#post",function(){if(!e.enabled)return false;e.trigger("save")}).on("change",".dynamic_embed_options_taxonomy",function(){var i=t(this),a=i.val();i.parent().find(".button").remove();if(a!=-1){if(i.parent().find("select").length<i.find("option").length-1)t(' <a class="button button-small add_embed_options_taxonomy">'+e.l10n.campaigns.add+"</a>").insertAfter(i)}else{i.parent().html("").append(i)}return false}).on("click",".add_embed_options_taxonomy",function(){var i=t(this),a=i.prev().clone();a.insertBefore(i).val("-1");t("<span> "+e.l10n.campaigns.or+" </span>").insertBefore(a);i.remove();return false});!e.editable&&e.events.push("documentReady",function(){e.$.window.off("beforeunload.edit-post")});function s(){clearTimeout(n);n=setTimeout(function(){e.trigger("refresh")},250)}return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.util=e.util||{};e.util.isTinyMCE=null;e.events.push("documentReady",function(){e.util.isTinyMCE=typeof tinymce=="object"});e.util.getRealDimensions=function(e,t){e=e.eq(0);if(e.is("img")&&e.attr("src")){var i=new Image,a;i.onload=function(){a=(i.width/e.width()).toFixed(1)||1;if(t)t.call(this,i.width,i.height,isFinite(a)?parseFloat(a):1)};i.src=e.attr("src")}};e.util.tempMsg=function(e,i,a,n){var s=t('<div class="'+i+'"><p>'+e+"</p></div>").hide().prependTo(a).slideDown(200).delay(200).fadeIn().delay(3e3).fadeTo(200,0).delay(200).slideUp(200,function(){s.remove();n&&n()});return s};e.util.selectRange=function(e,t,i){if(a.selection&&a.selection.createRange){e.focus();e.select();var n=a.selection.createRange();n.collapse(true);n.moveEnd("character",i);n.moveStart("character",t);n.select()}else{e.selectionStart=t;e.selectionEnd=i}return true};e.util.changeColor=function(i,a,n,s){if(!i)i=a;if(!a)return false;i=i.toUpperCase();a=a.toUpperCase();if(i==a)return false;var o=e.editor.getContent(),r=new RegExp(i,"gi");if(n)n.data("value",a);t("#mailster-color-"+i.substr(1)).attr("id","mailster-color-"+a.substr(1));if(r.test(o)){e.editor.setContent(o.replace(r,a),0)}if(s){}};e.util.replace=function(e,t,i){if(t===i)return e;do{e=e.replace(t,i)}while(t&&e.indexOf(t)!==-1);return e};return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.thickbox=e.thickbox||{};e.thickbox.$={};e.thickbox.$.preview=t(".mailster-preview-iframe");e.thickbox.$.preview.on("load",function(){var e=t(this),a=e.contents(),n=a.find("body");n.on("click","a",function(){var e=t(this).attr("href");if(e&&e!="#")i.open(e);return false})});return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";var n=t("#mailster_template"),s=t("#module-selector"),o=t("#module-search"),r=s.find("li"),l=t("a.toggle-modules");e.modules=e.modules||{};e.modules.showSelector=!!parseInt(i.getUserSetting("mailstershowmodules",1),10);e.modules.dragging=false;e.modules.selected=false;function c(t){for(var i in e.editor.colors.map){t=e.util.replace(t,i,e.editor.colors.map[i])}return t}function d(){var e=s.data("current"),i=t(this).parent().find("script").html();v(c(i),e&&e.is("module")?e:false,true,true)}function u(){var i=t(this).parent().parent().parent().addClass("ui-sortable-fly-over"),a=i.prev("module").addClass("ui-sortable-fly-under"),n=e.util.top()-a.height();i.css({transform:"translateY(-"+a.height()+"px)"});a.css({transform:"translateY("+i.height()+"px)"});e.util.scroll(n,function(){i.insertBefore(a.css({transform:""}).removeClass("ui-sortable-fly-under")).css({transform:""}).removeClass("ui-sortable-fly-over");e.trigger("refresh");e.trigger("save")},250)}function p(){var i=t(this).parent().parent().parent().addClass("ui-sortable-fly-over"),a=i.next("module").addClass("ui-sortable-fly-under"),n=e.util.top()+a.height();i.css({transform:"translateY("+a.height()+"px)"});a.css({transform:"translateY(-"+i.height()+"px)"});e.util.scroll(n,function(){i.insertAfter(a.css({transform:""}).removeClass("ui-sortable-fly-under")).css({transform:""}).removeClass("ui-sortable-fly-over");e.trigger("refresh");e.trigger("save")},250)}function f(){var e=t(this).parent().parent().parent(),i=e.clone().removeAttr("selected").hide();v(i,e,false,true)}function m(){var i=t(this).parent().parent().parent();e.editbar.open({element:i,name:i.attr("label"),type:"auto",offset:i.offset()})}function h(){var e=t(this),i=e.val(),a=e.parent().parent();if(!i){i=e.attr("placeholder");e.val(i)}a.attr("label",i)}function g(){var i=t(this).parent().parent().parent();i.fadeTo(25,0,function(){i.slideUp(100,function(){i.remove();e.trigger("refresh");if(!e.editor.$.modules.length)e.editor.$.container.html("");e.trigger("save")})})}function v(i,a,n,s){var o;if(typeof i=="string"){o=t(i)}else if(i instanceof jQuery){o=t(i);o.find("single, multi, buttons").removeAttr("contenteditable spellcheck id dir style class")}else{return false}if(!a&&!e.editor.$.container.length)return false;if(a){n?o.hide().insertBefore(a):o.hide().insertAfter(a)}else{if("footer"==e.editor.$.modules.last().attr("type")){o.hide().insertBefore(e.editor.$.modules.last())}else{o.hide().appendTo(e.editor.$.container)}}e.editor.updateElements();e.editor.moduleButtons();o.slideDown(100,function(){o.css("display","block");e.trigger("refresh");e.trigger("save")});if(s){var r=o.offset().top+e.$.template.offset().top-e.$.window.height()/2;e.util.scroll(r)}}function b(){var i=t(this).parent().parent().parent();e.editbar.open({element:i,name:i.attr("label"),type:"codeview",offset:i.offset()})}function _(){e.$.templateWrap.toggleClass("show-modules");e.modules.showSelector=!e.modules.showSelector;i.setUserSetting("mailstershowmodules",e.modules.showSelector?1:0);setTimeout(function(){e.trigger("resize")},200)}function k(){r.hide();s.find("li:contains('"+t(this).val()+"')").show()}function w(){var i,a=t("<dropzone></dropzone>"),n=a.clone(),o=a.add(n);e.editor.$.document.off(".mailster").on("click.mailster","button.up",u).on("click.mailster","button.down",p).on("click.mailster","button.auto",m).on("click.mailster","button.duplicate",f).on("click.mailster","button.remove",g).on("click.mailster","button.codeview",b).on("change.mailster","input.modulelabel",h);s.off(".mailster").on("dragstart.mailster","li",function(s){s.originalEvent.dataTransfer.setData("Text",this.id);e.modules.dragging=true;e.editor.$.body.addClass("drag-active");e.editor.$.container.on("dragenter.mailster",function(s){var o=t(s.target).closest("module");if(!o.length||i&&i[0]===o[0])return;i=o;n.appendTo(i);a.prependTo(i);setTimeout(function(){n.addClass("visible");a.addClass("visible");e.editor.$.modules.removeClass("drag-up drag-down");o.prevAll("module").addClass("drag-up");o.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(e){e.preventDefault()}).on("drop.mailster",function(n){var o=t(s.target).find("script").html();v(c(o),e.editor.$.modules.length?i&&i[0]===e.editor.$.container?false:i:false,a[0]===n.target,false,true);n.preventDefault()});o.on("dragenter.mailster",function(e){t(this).addClass("drag-over")}).on("dragleave.mailster",function(e){t(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(t){i=null;e.editor.$.body.removeClass("drag-active");o.removeClass("visible drag-over").remove();e.editor.$.modules.removeClass("drag-up drag-down");e.editor.$.container.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");o.off("dragenter.mailster").off("dragleave.mailster");e.modules.dragging=false})}t(".meta-box-sortables").on("sortstop",function(t,i){if(i.item[0]===e.dom.template){e.editor.$.body.addClass("reload-page")}});e.$.template.on("click","a.toggle-modules",_).on("keydown","a.addmodule",function(e){if(13==e.which){d.call(this)}}).on("click","a.addmodule",d).on("click","#module-search-remove",function(){o.val("").focus().trigger("keyup");return false});o.on("keyup",k).on("focus",function(){o.select()});e.events.push("editorLoaded",w);return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";var n={unknown_cities:[],geodata:null,map:null,options:{legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc",e.colors.main],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}}};e.$.details=t("#mailster_details .inside");e.details=e.details||{};e.details.$={};e.details.$.subject=t("#mailster_subject");e.details.$.preheader=t("#mailster_preheader");e.details.$.from=t("#mailster_from");e.details.$.from_name=t("#mailster_from-name");e.details.$.replyto=t("#mailster_reply-to");e.$.title.on("change",function(){if(!e.details.$.subject.val())e.details.$.subject.val(t(this).val())});e.$.details.on("click",".default-value",function(){var e=t(this);t("#"+e.data("for")).val(e.data("value"))}).on("click","#show_recipients",function(){var i=t(this),a=t("#recipients-list"),n=t("#recipients-ajax-loading");if(!a.is(":hidden")){i.removeClass("open");a.slideUp(100);return false}n.css("display","inline");e.util.ajax("get_recipients",{id:e.campaign_id},function(e){i.addClass("open");n.hide();a.html(e.html).slideDown(100)},function(e,t,i){n.hide()});return false}).on("click","#show_clicks",function(){var i=t(this),a=t("#clicks-list"),n=t("#clicks-ajax-loading");if(!a.is(":hidden")){i.removeClass("open");a.slideUp(100);return false}n.css("display","inline");e.util.ajax("get_clicks",{id:e.campaign_id},function(e){i.addClass("open");n.hide();a.html(e.html).slideDown(100)},function(e,t,i){n.hide()});return false}).on("click","#show_environment",function(){var i=t(this),a=t("#environment-list"),n=t("#environment-ajax-loading");if(!a.is(":hidden")){i.removeClass("open");a.slideUp(100);return false}n.css("display","inline");e.util.ajax("get_environment",{id:e.campaign_id},function(e){i.addClass("open");n.hide();a.html(e.html).slideDown(100)},function(e,t,i){n.hide()});return false}).on("click","#show_geolocation",function(){var i=t(this),l=t("#geolocation-list"),c=t("#geolocation-ajax-loading");if(!l.is(":hidden")){i.removeClass("open");l.slideUp(100);return false}c.css("display","inline");e.util.ajax("get_geolocation",{id:e.campaign_id},function(d){i.addClass("open");c.hide();n.geodata=d.geodata;n.unknown_cities=d.unknown_cities;l.html(d.html).slideDown(100,function(){google.load("visualization","1.0",{packages:["geochart","corechart"],mapsApiKey:e.l10n.google?e.l10n.google.key:null,callback:function(){var e;n.map=new google.visualization.GeoChart(a.getElementById("countries_map"));google.countrydata=google.visualization.arrayToDataTable(d.countrydata);if(location.hash&&(e=location.hash.match(/region=([A-Z]{2})/))){o(e[1])}else{r(google.countrydata)}google.visualization.events.addListener(n.map,"regionClick",o)}});t("a.zoomout").on("click",function(){s();return false});t("#countries_table").find("tbody").find("tr").on("click",function(){var e=t(this).data("code");e=="unknown"||!e?s():o(e);return false})})},function(e,t,i){c.hide()});return false}).on("click","#show_errors",function(){var i=t(this),a=t("#error-list"),n=t("#error-ajax-loading");if(!a.is(":hidden")){i.removeClass("open");a.slideUp(100);return false}n.css("display","inline");e.util.ajax("get_errors",{id:e.campaign_id},function(e){i.addClass("open");n.hide();a.html(e.html).slideDown(100)},function(e,t,i){n.hide()});return false}).on("click","#show_countries",function(){t("#countries_wrap").toggle();return false}).on("click",".load-more-receivers",function(){var i=t(this),a=i.data("page"),n=i.data("types"),s=i.data("orderby"),o=i.data("order"),r=i.next().css("display","inline");e.util.ajax("get_recipients_page",{id:e.campaign_id,types:n,page:a,orderby:s,order:o},function(e){r.hide();if(e.success){i.parent().parent().replaceWith(e.html)}},function(e,t,i){detailbox.removeClass("loading")});return false}).on("click",".recipients-limit",function(e){if(e.altKey){t("input.recipients-limit").prop("checked",false);t(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(i){var a=t("#recipients-list"),n=t("#recipients-ajax-loading"),s=t("input.recipients-limit:checked").map(function(){return this.value}).get(),o=t("select.recipients-order").val(),r=t("a.recipients-order").hasClass("asc")?"ASC":"DESC";n.css("display","inline");t("input.recipients-limit").prop("disabled",true);e.util.ajax("get_recipients",{id:e.campaign_id,types:s.join(","),orderby:o,order:r},function(e){n.hide();t("input.recipients-limit").prop("disabled",false);a.html(e.html).slideDown(100)},function(e,t,i){n.hide()});return false}).on("click","a.recipients-order",function(){t(this).toggleClass("asc");t("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var i=t(this),a=i.data("id"),n=t("#receiver-detail-"+a).show();i.parent().addClass("loading").parent().addClass("expanded");e.util.ajax("get_recipient_detail",{id:a,campaignid:e.campaign_id},function(e){i.parent().removeClass("loading");if(e.success){n.find("div.receiver-detail-body").html(e.html).slideDown(100)}},function(e,t,i){n.removeClass("loading")});return false}).on("click","#stats label",function(){t("#recipients-list").find("input").prop("checked",false).filter("input."+t(this).attr("class")).prop("checked",true).trigger("change")});t.easyPieChart&&e.$.details.find(".piechart").easyPieChart({animate:2e3,rotate:180,barColor:e.colors.main,trackColor:e.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}});function s(){var i={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9",e.colors.main]};r(google.countrydata,i);t("#countries_table").find("tr").removeClass("wp-ui-highlight");t("#mapinfo").hide();location.hash="#region="}function o(i){var a={},s=i.region?i.region:i,o,l;if(s.match(/-/))return false;a["region"]=s;n.unknown_cities[s]?t("#mapinfo").show().html(e.util.sprintf(e.l10n.campaigns.unknown_locations,n.unknown_cities[s])):t("#mapinfo").hide();o=n.geodata[s]?n.geodata[s]:[];a["resolution"]="provinces";a["displayMode"]="markers";a["dataMode"]="markers";a["colors"]=["#4EBEE9",e.colors.main];l=new google.visualization.DataTable;l.addColumn("number","Lat");l.addColumn("number","Long");l.addColumn("string","tooltip");l.addColumn("number","Value");l.addColumn({type:"string",role:"tooltip"});l.addRows(o);t("#countries_table").find("tr").removeClass("wp-ui-highlight");t("#country-row-"+s).addClass("wp-ui-highlight");location.hash="#region="+s;r(l,a)}function r(e,i){i=t.extend(n.options,i);n.map.draw(e,i);t("a.zoomout").css({visibility:i["region"]!="world"?"visible":"hidden"})}function l(e){var i=e;t.each(regions,function(a,n){if(t.inArray(e,n)!=-1)i=a});return i}return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.clickmap=e.clickmap||{};e.clickmap.$={};e.clickmap.$.popup=t("#clickmap-stats");e.$.template.on("click","a.getplaintext",function(){var t=e.$.excerpt.val();e.$.excerpt.val(e.l10n.campaigns.loading);e.util.ajax("get_plaintext",{html:e.editor.getContent()},function(t){e.$.excerpt.val(t)},function(i,a,n){e.$.excerpt.val(t)},"HTML")}).on("change","#plaintext",function(){var i=t(this).is(":checked");e.$.excerpt.prop("disabled",i)[i?"addClass":"removeClass"]("disabled")}).on("mouseenter","a.clickbadge",function(){var i=t(this),a=i.position(),n=i.data("p"),s=i.data("link"),o=i.data("clicks"),r=i.data("total");e.clickmap.$.popup.find(".piechart").data("easyPieChart").update(n);e.clickmap.$.popup.find(".link").html(s);e.clickmap.$.popup.find(".clicks").html(o);e.clickmap.$.popup.find(".total").html(r);e.clickmap.$.popup.stop().fadeIn(100).css({top:a.top-85,left:a.left-(e.clickmap.$.popup.width()/2-i.width()/2)})}).on("mouseleave","a.clickbadge",function(){e.clickmap.$.popup.stop().fadeOut(400)});e.clickmap.updateBadges=function(i){e.$.templateWrap.find(".clickbadge").remove();var i=i||t("#mailster_click_stats").data("stats"),a=parseInt(i.total,10);if(!a)return;t.each(i.clicks,function(i,n){t.each(n,function(n,s){var o=e.$.iframe.contents().find('a[href="'+i.replace("&amp;","&")+'"]').eq(n);if(o.length){o.css("display","inline-block");var r=o.offset(),l=r.top,c=r.left+5,d=s.clicks/a*100,u=(d<1?"&lsaquo;1":Math.round(d))+"%",p=t('<a class="clickbadge '+(d<40?"clickbadge-outside":"")+'" data-p="'+d+'" data-link="'+i+'" data-clicks="'+s.clicks+'" data-total="'+s.total+'"><span style="width:'+Math.max(0,d-2)+'%">'+(d<40?"&nbsp;":u)+"</span>"+(d<40?" "+u:"")+"</a>").css({top:l,left:c}).appendTo(e.$.templateWrap)}})})};e.editable&&i.EmojiButton&&e.events.push("documentReady",function(){t(".emoji-selector").on("click","button",function(){var e=a.querySelector("#"+t(this).data("input")),i=new EmojiButton({emojiVersion:"3.0",showVariants:false,zIndex:1e3});i.togglePicker(this);i.on("emoji",function(t){var i=e.selectionStart;e.value=e.value.substring(0,i)+t+e.value.substring(i);setTimeout(function(){e.focus();e.setSelectionRange(i+1,i+1)},10)});return false})});!e.editable&&e.events.push("documentReady",function(){t.easyPieChart&&e.clickmap.$.popup.find(".piechart").easyPieChart({animate:2e3,rotate:180,barColor:e.colors.main,trackColor:e.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}})});!e.editable&&e.events.push("iframeLoaded",function(){e.$.iframe.height(Math.max(500,e.dom.iframe.contentWindow.document.body.scrollHeight));e.clickmap.updateBadges();e.$.iframecontents&&e.$.iframecontents.on("click","a",function(){i.open(this.href);return false})});return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.$.submit=t("#mailster_submitdiv .inside");e.submit=e.submit||{};e.$.submit.on("change","#use_pwd",function(){t("#password-wrap").slideToggle(200).find("input").focus().select();t("#post_password").prop("disabled",!t(this).is(":checked"))}).on("click",".sendnow-button",function(){if(!confirm(e.l10n.campaigns.send_now))return false});e.submit.$={};return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.$.delivery=t("#mailster_delivery .inside");e.delivery=e.delivery||{};e.delivery.$={};e.$.delivery.on("change","input.timezone",function(){t(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){t(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){t(this).parent().parent().parent().find("span").addClass("disabled");t(this).parent().find("span").removeClass("disabled")}).on("change","#autoresponder-post_type",function(){var i=t("#autoresponder-taxonomies");i.find("select").prop("disabled",true);e.util.ajax("get_post_term_dropdown",{labels:false,names:true,posttype:t(this).val()},function(e){if(e.success){i.html(e.html)}},function(e,t,i){n(false)})}).on("click",".category-tabs a",function(){var i=t(this),a=i.attr("href");e.$.delivery.find(".tabs-panel").hide();e.$.delivery.find(".tabs").removeClass("tabs");i.parent().addClass("tabs");t(a).show();t("#mailster_is_autoresponder").val(a=="#autoresponder"?1:"");return false}).on("click",".mailster_sendtest",function(){var i=t(this);n(true);i.prop("disabled",true);e.trigger("save");e.util.ajax("send_test",{formdata:e.$.form.serialize(),to:t("#mailster_testmail").val()?t("#mailster_testmail").val():t("#mailster_testmail").attr("placeholder"),content:e.$.content.val(),head:e.$.head.val(),plaintext:e.$.excerpt.val()},function(t){n(false);i.prop("disabled",false);e.util.tempMsg(t.msg,!t.success?"error":"updated",i.parent())},function(t,a,s){n(false);i.prop("disabled",false);e.util.tempMsg(rtextStatus+" "+t.status+": "+s,"error",i.parent())})}).on("change","#mailster_data_active",function(){t(this).is(":checked")?t(".active_wrap").addClass("disabled"):t(".active_wrap").removeClass("disabled");t(".deliverydate, .deliverytime").prop("disabled",!t(this).is(":checked"))}).on("change","#mailster_data_autoresponder_active",function(){t(this).is(":checked")?t(".autoresponder_active_wrap").addClass("disabled"):t(".autoresponder_active_wrap").removeClass("disabled")}).on("click",".mailster_spamscore",function(){var i=t(this),a=t("#spam_score_progress").removeClass("spam-score").slideDown(200),o=a.find(".bar");n(true);i.prop("disabled",true);t(".score").html("");e.trigger("save");o.css("width","20%");e.util.ajax("send_test",{spamtest:true,formdata:e.$.form.serialize(),to:t("#mailster_testmail").val()?t("#mailster_testmail").val():t("#mailster_testmail").attr("placeholder"),content:e.$.content.val(),head:e.$.head.val(),plaintext:e.$.excerpt.val()},function(t){if(t.success){o.css("width","40%");s(t.id,1)}else{n(false);a.slideUp(200);e.util.tempMsg(t.msg,"error",i.parent())}},function(t,a,s){n(false);i.prop("disabled",false);e.util.tempMsg(rtextStatus+" "+t.status+": "+s,"error",i.parent())})}).on("blur","input.deliverytime",function(){e.$.document.unbind(".mailster_deliverytime")}).on("focus, click","input.deliverytime",function(i){var n=t(this),s=t(this)[0],o=n.offset().left,r=0,l=0,c=2;if(i.clientX-o>23){r=1,l=3,c=5}e.$.document.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(t){if(t.keyCode==9){return(r=!r)?!e.util.selectRange(s,3,5):t.shiftKey?!e.util.selectRange(s,0,2):true}}).on("keyup.mailster_deliverytime",function(t){if(n.val().length==1){n.val(n.val()+":00");e.util.selectRange(s,1,1)}if(a.activeElement.selectionStart==2){if(n.val().substr(0,2)>23){n.trigger("change");return false}e.util.selectRange(s,3,5)}});e.util.selectRange(s,l,c)}).on("change","input.deliverytime",function(){var i=t(this),a=i.val(),n;i.addClass("inactive");if(!/^\d+:\d+$/.test(a)){if(a.length==1){a="0"+a+":00"}else if(a.length==2){a=a+":00"}else if(a.length==3){a=a.substr(0,2)+":"+a.substr(2,3)+"0"}else if(a.length==4){a=a.substr(0,2)+":"+a.substr(2,4)}}n=a.split(":");if(!/\d\d:\d\d$/.test(a)&&a!=""||n[0]>23||n[1]>59){i.val("00:00").focus();e.util.selectRange(i[0],0,2)}else{i.val(a)}}).on("change","#mailster_autoresponder_action",function(){t("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+t(this).val())}).on("change","#time_extra",function(){t("#autoresponderfield-mailster_timebased_advanced").slideToggle()}).on("click",".mailster_autoresponder_timebased-end-schedule",function(){t(this).is(":checked")?t(".mailster_autoresponder_timebased-end-schedule-field").slideDown():t(".mailster_autoresponder_timebased-end-schedule-field").slideUp()}).on("change",".mailster-action-hooks",function(){var e=t(this).val();t(".mailster-action-hook").val(e);if(!e){t(".mailster-action-hook").focus()}}).on("change",".mailster-action-hook",function(){var e=t(this).val();if(!t(".mailster-action-hooks option[value='"+e+"']").length){t(".mailster-action-hooks").append("<option>"+e+"</option>")}t(".mailster-action-hooks").val(e)}).on("click",".mailster-total",function(){e.trigger("updateCount")}).on("change","#list_extra",function(){if(t(this).is(":checked")){t("#mailster_list_advanced").slideDown()}else{t("#mailster_list_advanced").slideUp()}t("#list-checkboxes").find("input.list").eq(0).trigger("change")}).on("focus","input.datepicker",function(){t(this).removeClass("inactive").trigger("click")}).on("blur","input.datepicker",function(){t(".deliverydate").html(t(this).val());t(this).addClass("inactive")});t.datepicker&&e.$.delivery.find("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date,firstDay:e.l10n.campaigns.start_of_week,showWeek:true,dayNames:e.l10n.campaigns.day_names,dayNamesMin:e.l10n.campaigns.day_names_min,monthNames:e.l10n.campaigns.month_names,prevText:e.l10n.campaigns.prev,nextText:e.l10n.campaigns.next,showAnim:"fadeIn",onClose:function(){var e=t(this).datepicker("getDate");t(".deliverydate").html(t(this).val())}});t.datepicker&&t("input.datepicker.nolimit").datepicker("option","minDate",null);e.$.delivery.find("input.datepicker").not(".hasDatepicker").prop("readonly",false);e.events.push("documentReady",function(){if(/post_status=autoresponder/.test(t("#referredby").val())||/post_status=autoresponder/.test(location.search)){e.$.delivery.find('a[href="#autoresponder"]').click()}});(function(){var i,a,n,s,o,r=new Date,l=t(".time"),c=t(".deliverytime").eq(0),d=t("#mailster_data_active"),u=parseInt(l.data("timestamp"),10)*1e3,p=false,f=u-r.getTime()+r.getTimezoneOffset()*6e4;var m=p?1e3:2e4;function h(){i=new Date;r=i.getTime();i.setTime(r+f);n=i.getHours();s=i.getMinutes();if(e.enabled&&a&&s!=a[1]&&!d.is(":checked")){c.val(g(n)+":"+g(s))}a=[];a.push(i.getHours());a.push(i.getMinutes());if(p)a.push(i.getSeconds());o=a.length;for(var t=0;t<o;t++){a[t]=g(a[t])}l.html(a.join('<span class="blink">:</span>'));setTimeout(function(){h()},m)}function g(e){if(e<10){e="0"+e}return e}h()})();function n(e){if(null==e||true===e){t("#delivery-ajax-loading").css("display","inline")}else{t("#delivery-ajax-loading").hide()}}function s(i,a){var o=t(".mailster_spamscore"),r=t("#spam_score_progress"),l=r.find(".bar");e.util.ajax("check_spam_score",{ID:i},function(c){if(c.score){n(false);o.prop("disabled",false);r.addClass("spam-score");l.css("width",parseFloat(c.score)*10+"%");t(".score").html("<strong>"+e.util.sprintf(e.l10n.campaigns.yourscore,c.score)+"</strong>:<br>"+e.l10n.campaigns.yourscores[Math.floor(c.score/10*e.l10n.campaigns.yourscores.length)])}else{if(a<=5&&!c.abort){var d=a*10+50;l.css("width",d+"%");setTimeout(function(){s(i,++a)},a*400)}else{n(false);o.prop("disabled",false);l.css("width","100%");r.slideUp(200);e.util.tempMsg(c.msg,"error",o.parent(),function(){l.css("width",0)})}}},function(i,a,s){n(false);$this.prop("disabled",false);e.util.tempMsg(rtextStatus+" "+i.status+": "+s,"error",$this.parent());var o=t('<div class="error"><p>'+a+" "+i.status+": "+s+"</p></div>").hide().prependTo($this.parent()).slideDown(200).delay(200).fadeIn().delay(3e3).fadeTo(200,0).delay(200).slideUp(200,function(){o.remove()})})}return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";var n;e.$.receivers=t("#mailster_receivers .inside");e.receivers=e.receivers||{};e.receivers.$={};e.receivers.$.conditions=t(".mailster-conditions-thickbox");e.receivers.$.conditionsOutput=t("#mailster_conditions_render");e.receivers.$.total=t(".mailster-total");e.$.receivers.on("change","input.list",function(){e.trigger("updateCount")}).on("change","#all_lists",function(){t("#list-checkboxes").find("input.list").prop("checked",t(this).is(":checked"));e.trigger("updateCount")}).on("change","#ignore_lists",function(){var i=t(this).is(":checked");t("#list-checkboxes").each(function(){i?t(this).slideUp(200):t(this).slideDown(200)});e.trigger("updateCount")}).on("click",".edit-conditions",function(){tb_show(e.l10n.campaigns.edit_conditions,"#TB_inline?x=1&width=720&height=520&inlineId=receivers-dialog",null);return false}).on("click",".remove-conditions",function(){if(confirm(e.l10n.campaigns.remove_conditions)){t("#receivers-dialog").find(".mailster-conditions-wrap").empty();e.trigger("updateCount")}return false}).on("click",".mailster-total",function(){e.trigger("updateCount")}).on("click",".create-new-list",function(){var e=t(this).hide();t(".create-new-list-wrap").slideDown();t(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var i=t(this),a=t(".create-list-type"),n="";if(a.val()==-1)return false;if(n=prompt(e.l10n.campaigns.enter_list_name,e.util.sprintf(e.l10n.campaigns.create_list,a.find(":selected").text(),t("#title").val()))){s(true);e.util.ajax("create_list",{name:n,listtype:a.val(),id:e.campaign_id},function(i){s(false);e.util.tempMsg(i.msg,!i.success?"error":"updated",t(".create-new-list-wrap"))},function(i,a,n){s(false);e.util.tempMsg(rtextStatus+" "+i.status+": "+n,"error",t(".create-new-list-wrap"))})}return false}).on("change",".create-list-type",function(){var i=t(this);if(i.val()==-1)return false;i.prop("disabled",true);s(true);e.util.ajax("get_create_list_count",{listtype:i.val(),id:e.campaign_id},function(e){i.prop("disabled",false);s(false,e.count)},function(e,t,a){i.prop("disabled",false);s(false,"")})}).on("click",".mailster-total",function(){t(".create-list-type").trigger("change")});i.tb_remove&&e.receivers.$.conditions.on("click",".close-conditions",tb_remove);e.editable&&e.events.push("documentReady",function(){e.trigger("updateCount")});e.events.push("documentReady",function(){e.trigger("enable")});e.editable&&e.events.push("updateCount",function(){clearTimeout(n);n=setTimeout(function(){var i=[],a=[],n=t("#list-checkboxes").find("input, select"),o=t("#list-checkboxes").find("input.list"),r=t("#list_extra"),l={},c=t(".mailster-conditions-wrap > .mailster-condition-group"),d=0;t.each(o,function(){var e=t(this).val();if(t(this).is(":checked"))i.push(e)});l.id=e.campaign_id;l.lists=i;l.ignore_lists=t("#ignore_lists").is(":checked");t.each(c,function(){var e=t(this).find(".mailster-condition");t.each(e,function(){var e=t(this),i,n=e.find(".condition-field").val(),s=e.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!s||!n)return;i=e.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return t(this).val()}).toArray();if(i.length==1){i=i[0]}if(!a[d]){a[d]=[]}a[d].push({field:n,operator:s,value:i})});d++});l.operator=t("select.mailster-list-operator").val();l.conditions=a;s(true);e.trigger("disable");e.util.ajax("get_totals",l,function(t){e.trigger("enable");s(false,t.totalformatted);e.receivers.$.conditionsOutput.html(t.conditions)},function(t,i,a){e.trigger("enable");s(false,"?")})},10)});function s(t,i){if(null==t||true===t){e.receivers.$.total.addClass("loading")}else{e.receivers.$.total.removeClass("loading")}if(null!=i){e.receivers.$.total.html(i)}}return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.$.options=t("#mailster_options .inside");e.options=e.options||{};e.options.$={};e.options.$.colorInputs=e.$.options.find("input.color");e.$.options.on("click",".wp-color-result",function(){t(this).closest("li.mailster-color").addClass("open")}).on("click","a.default-value",function(){var e=t(this).prev().find("input"),i=e.data("default");e.wpColorPicker("color",i);return false}).on("click","ul.colorschema",function(){var i=e.$.options.find("input.color"),a=t(this).find("li.colorschema-field");e.trigger("disable");t.each(a,function(e){var t=a.eq(e).data("hex");i.eq(e).wpColorPicker("color",t)});e.trigger("enable")}).on("click","a.savecolorschema",function(){var i=t.map(e.$.options.find(".color"),function(e){return t(e).val()});n(true);e.util.ajax("save_color_schema",{template:t("#mailster_template_name").val(),colors:i},function(e){n(false);if(e.success){t(".colorschema").last().after(t(e.html).hide().fadeIn())}},function(e,t,i){n(false)})}).on("click",".colorschema-delete",function(){if(confirm(e.l10n.campaigns.delete_colorschema)){var i=t(this).parent().parent();n(true);e.util.ajax("delete_color_schema",{template:t("#mailster_template_name").val(),hash:i.data("hash")},function(e){n(false);if(e.success){i.fadeOut(100,function(){i.remove()})}},function(e,t,i){n(false)})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(e.l10n.campaigns.delete_colorschema_all)){var i=t(".colorschema.custom");n(true);e.util.ajax("delete_color_schema_all",{template:t("#mailster_template_name").val()},function(e){n(false);if(e.success){i.fadeOut(100,function(){i.remove()})}},function(e,t,i){n(false)})}return false}).on("change","#mailster_version",function(){var e=t(this).val();_changeElements(e)}).on("change","input.color",function(i,a){var n=t(this);var s=Color(n.val()).toString().toUpperCase();var o=n.data("value");var r=n.data("default-color");n.val(s);e.util.changeColor(o,s,n,r)});t.wp.wpColorPicker&&e.options.$.colorInputs.wpColorPicker({color:true,width:250,mode:"hsl",palettes:t(".colors").data("original"),change:function(e,i){t(this).val(i.color.toString()).trigger("change")},clear:function(e,t){}});function n(e){if(null==e||true===e){t("#colorschema-ajax-loading").css("display","inline")}else{t("#colorschema-ajax-loading").hide()}}return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.$.attachments=t("#mailster_attachments .inside");e.attachments=e.attachments||{};e.attachments.$={};e.$.attachments.on("click",".delete-attachment",function(e){e.preventDefault();t(this).parent().remove()}).on("click",".add-attachment",function(i){i.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:e.l10n.campaigns.add_attachment,button:{text:e.l10n.campaigns.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var e=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),i=t(".mailster-attachment").eq(0).clone();i.find("img").attr("src",e.icon);i.find(".mailster-attachment-label").html(e.filename);i.find("input").attr("name","mailster_data[attachments][]").val(e.id);i.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});return e}(mailster||{},jQuery,window,document);mailster=function(e,t,i,a){"use strict";e.events.push("documentReady",function(){if(typeof wp!="undefined"&&wp.heartbeat)wp.heartbeat.interval("fast")});e.$.document.on("heartbeat-send",function(t,i){if(e.editable){if(i&&i["wp_autosave"]&&e.editor){i["wp_autosave"]["content"]=e.editor.getContent();i["wp_autosave"]["excerpt"]=e.$.excerpt.val();i["mailsterdata"]=e.$.datafields.serialize()}}else{if(i["wp_autosave"])delete i["wp_autosave"];i["mailster"]={page:"edit",id:e.campaign_id}}}).on("heartbeat-tick",function(i,a){if(e.editable||!a.mailster||!a.mailster[e.campaign_id])return;var n=a.mailster[e.campaign_id],s=t("#stats").find(".verybold"),o=t("#stats").find(".piechart"),r=t(".progress"),l=n.sent/n.total*100;t(".hb-sent").html(n.sent_f);t(".hb-deleted").html(n.deleted_f);t(".hb-opens").html(n.opens_f);t(".hb-clicks").html(n.clicks_f);t(".hb-clicks_total").html(n.clicks_total_f);t(".hb-unsubs").html(n.unsubs_f);t(".hb-bounces").html(n.bounces_f);t(".hb-geo_location").html(n.geo_location);t.each(n.environment,function(e){t(".hb-"+e).html((this.percentage*100).toFixed(2)+"%")});if(t("#stats_opens").length)t("#stats_opens").data("easyPieChart").update(Math.round(n.open_rate));if(t("#stats_clicks").length)t("#stats_clicks").data("easyPieChart").update(Math.round(n.click_rate));if(t("#stats_unsubscribes").length)t("#stats_unsubscribes").data("easyPieChart").update(Math.round(n.unsub_rate));if(t("#stats_bounces").length)t("#stats_bounces").data("easyPieChart").update(Math.round(n.bounce_rate));r.find(".bar").width(l+"%");r.find("span").eq(1).html(n.sent_formatted);r.find("span").eq(2).html(n.sent_formatted);r.find("var").html(Math.round(l)+"%");e.clickmap.updateBadges(n.clickbadges);if(n.status!=t("#original_post_status").val()&&!t("#mailster_status_changed_info").length){t('<div id="mailster_status_changed_info" class="error inline"><p>'+e.util.sprintf(e.l10n.campaigns.statuschanged,'<a href="post.php?post='+e.campaign_id+'&action=edit">'+e.l10n.campaigns.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});return e}(mailster||{},jQuery,window,document);